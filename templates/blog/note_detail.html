{% extends "base.html" %}

{% block title %}Szczegóły notatki{% endblock %}

{% block content %}
<section class="note-detail">
    <header class="note-detail-header">
        <h1>{{ note.title }}</h1>
        <span class="note-priority note-priority-{{ note.priority }}">
            {{ note.get_priority_display }}
        </span>
    </header>

    <div class="note-content-box">
        {{ note.content|linebreaksbr }} {# linebreaksbr zamienia entery na <br> #}
    </div>

    <dl class="note-grid">
        {% if note.category %} {# jeśli notatka ma kategorię, pokażemy ją #}
            <div>
                <dt>Kategoria</dt>
                <dd>{{ note.category.name }}</dd>
            </div>
        {% endif %}
        {% if note.due_date %} {# tak samo z terminem #}
            <div>
                <dt>Termin</dt>
                <dd>{{ note.due_date }}</dd>
            </div>
        {% endif %}
        <div>
            <dt>Utworzono</dt>
            <dd>{{ note.created_at|date:"Y-m-d H:i" }}</dd>
        </div>
        <div>
            <dt>Ostatnia zmiana</dt>
            <dd>{{ note.updated_at|date:"Y-m-d H:i" }}</dd>
        </div>
    </dl>

    <p class="note-actions">
        <a href="{% url 'blog:note_update' note.pk %}">Edytuj</a> ·
        <a href="{% url 'blog:note_delete' note.pk %}">Usuń</a> ·
        <a href="{% url 'blog:note_list' %}">Wróć do listy</a>
    </p>

    <section class="note-tasks">
        <h2>Zadania</h2>

        <p><a href="{% url 'blog:task_add' note.pk %}">Dodaj zadanie</a></p>

        {% if note.tasks.exists %}
            <ul>
                {% for task in note.tasks.all %}
                    <li>
                        <form action="{% url 'blog:task_toggle_done' task.pk %}"
                              method="post" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="task-toggle">
                                {% if task.is_done %}✅{% else %}⬜{% endif %}
                            </button>
                        </form>
                        <span class="{% if task.is_done %}task-done{% endif %}">
                            {{ task.title }}
                        </span>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>Brak zadań dla tej notatki.</p>
        {% endif %}
    </section>
</section>
{% endblock %}
